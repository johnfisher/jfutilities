# Znyx Networks
# OA4 configuration file 
# for recovery and upgrade
# (used by python ConfigParser)
#################################
# End user: DO NOT EDIT THIS FILE
#################################

[data]
# znyx platform; b1c and b1n are different; use lower case.
platform: zx8100
# OA4 release
release: 4.1.7
zupdate_ver: 1
# partition numbering
recoverpart: /dev/sda1
mainpart: /dev/sda1
# legacy = 1 partition; recovery = two partitions
# "legacy" = ( mbr)  vs recovery = "gpt" (efi)
diskplan: legacy
#  changed in every release
mainbz2: oa4-hv-8100-main.raw.bz2
recoverybz2: oa4-hv-8100-recovery.raw.bz2
entirebz2: oa4-hv-8100.raw.bz2
# recovery not implemented = false ; is implemented = true
recoveryplan: false
# apt-get upgrade available
apt-get-available: true
tarball dir: Znyx-ZX8100-1671
os-to-ipmi-eth: eth2
os-to-ipmi-br: br2
os-to-ipmi-eth-addr: 192.168.1.102
ipmi-lan-channel: 5
# must match below in firmware-jobs
ipmi-lan-addr: 192.168.1.100 

[recipe]
IPMC FW: 1.18 
IPMC BootLdr: 1.13  
FRU Info: 1.03  
MAC EEPROMs: 2.00  
FPGA Image: 7.00  
CPLD Image: 11.00  
UEFI FW: 2.14
pdr: 1671

[apt-jobs]
1: apt-get update -q 
2: export DEBIAN_FRONTEND=noninteractive && apt-get dist-upgrade -q -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confnew"
3: export DEBIAN_FRONTEND=noninteractive && apt-get install -q -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confnew" libcurl3 curl pbzip2 linux-image-3.2.16oa4 linux-headers-3.2.16oa4

[apt-jobs-vm-base]
1:	echo " no new packages in this release."

[apt-jobs-vm-fab]
1:	echo " no new packages in this release."

[firmware-jobs]
# NOTE using XsemiX as a placeholder for semicolons
# semicolons are inline comment delimiters in python 2.7
1:	ipmitool hpm check > /tmp/tmp-file
2:	echo "y" | ipmitool -H 192.168.1.100 -A none  -z 248 hpm upgrade 8100-fw.hpm1 activate
3:	if grep -q "CPLD " /tmp/tmp-file XsemiX then echo "y" | ipmitool -H 192.168.1.100 -A none  -z 248 hpm upgrade zx8100-std-1671.hpm1 activate XsemiX
		elif grep -q CPLD2 /tmp/tmp-file XsemiX then echo "y" | ipmitool -H 192.168.1.100 -A none  -z 248 hpm upgrade zx8100-pam-1671.hpm1 activate XsemiX fi
4:	rm /tmp/tmp-file

[sources.list]
# upgrade to platform-specific URLs
1:	cp /etc/apt/sources.list /etc/apt/sources.list.4.1.5
2:	echo "# ZNYX OA4 Repository - releases accessed by ZNYX platform:" > /etc/apt/sources.list
3:	echo "deb http://oa4.znyx.com/repo/8100/ precise main universe" >> /etc/apt/sources.list
4:	echo "deb http://oa4.znyx.com/repo/8100/ precise-updates main universe" >> /etc/apt/sources.list
5:	echo "deb http://oa4.znyx.com/repo/8100/znyx precise main" >> /etc/apt/sources.list
6:	echo "" >> /etc/apt/sources.list
7:	echo "## Comment out these security URLs if you DO NOT wish to download security patched pacakges from Ubuntu" >> /etc/apt/sources.list
8:	echo "deb http://security.ubuntu.com/ubuntu precise-security main restricted" >> /etc/apt/sources.list
9:	echo "deb http://security.ubuntu.com/ubuntu precise-security universe" >> /etc/apt/sources.list
10:	echo "deb http://security.ubuntu.com/ubuntu precise-security multiverse" >> /etc/apt/sources.list


[valid-versions]
# valid versions of OA4 to upgrade from
1:	4.1.5
2:	4.1.6.1
3:	4.1.7

